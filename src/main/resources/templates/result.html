<!doctype html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Simulado • Resultado</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/styles.css}"/>


    <style>
        :root{
            --bs-primary:#0b2a5b; /* azul escuro */
            --bs-success:#28a745;
            --bs-danger:#dc3545;
        }
        body{
            min-height:100vh;
            background:
                    radial-gradient(1200px 600px at 10% -20%, rgba(11,42,91,.08), transparent 60%),
                    radial-gradient(1200px 600px at 110% 120%, rgba(11,42,91,.08), transparent 60%),
                    #f7f9fc;
            padding-bottom: 84px; /* espaço pro rodapé fixo dos botões */
        }
        .card-glass{
            background: rgba(255,255,255,.94);
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            border: 1px solid rgba(11,42,91,.06);
            box-shadow: 0 10px 30px rgba(11,42,91,.08);
        }
        .brand-logo{height:32px}
        .metric-card{ border-left: .35rem solid var(--bs-primary); }
        .metric-ok{ border-left-color: var(--bs-success); }
        .metric-bad{ border-left-color: var(--bs-danger); }
        .answer-line{border-radius:.5rem; padding:.75rem 1rem; background:#fff; border:1px solid #e5e7eb}
        .answer-line + .answer-line{margin-top:.75rem}
        .badge-wide{min-width: 84px; justify-content:center}
        /* botãozão fixo no rodapé */
        .action-footer{
            position: fixed; left:0; right:0; bottom:0; z-index:1030;
            background: rgba(33,37,41,.98);
            padding: .75rem 1rem;
            box-shadow: 0 -6px 20px rgba(0,0,0,.12);
        }
        @media print{
            .action-footer, nav{ display:none !important; }
            body{ padding:0; background:#fff; }
            .card-glass{ box-shadow:none; border:0; }
        }
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-dark bg-dark">
    <div class="container px-4 px-lg-5">
        <a class="navbar-brand d-flex align-items-center" th:href="@{/}">
            <img class="brand-logo me-2" th:src="@{/assets/img/logo.png}" alt="Simulado Online">
            <span>Simulado Online</span>
        </a>
    </div>
</nav>

<main class="container py-4">

    <!-- Metricas -->
    <div class="row g-3 align-items-stretch">  <!-- ADICIONE align-items-stretch -->
        <div class="fs-3 text-dark">
            <span>Participante: </span>
            <strong class="fs-4 fw-bold" th:text="${nome}">Nome</strong>
        </div>
        <div class="col-12 col-md-4 d-flex">     <!-- ADICIONE d-flex -->
            <div class="card card-glass metric-card metric-ok h-100 w-100"> <!-- ADICIONE h-100 w-100 -->
                <div class="card-body">
                    <div class="text-muted small">Acertos</div>
                    <div class="display-6 fw-bold" th:text="${acertos}">0</div>
                    <div class="text-muted small invisible">placeholder</div> <!-- opcional, ver #2 -->
                </div>
            </div>
        </div>

        <div class="col-12 col-md-4 d-flex">
            <div class="card card-glass metric-card metric-bad h-100 w-100">
                <div class="card-body">
                    <div class="text-muted small">Erros</div>
                    <div class="display-6 fw-bold" th:text="${erros}">0</div>
                    <div class="text-muted small invisible">placeholder</div> <!-- opcional -->
                </div>
            </div>
        </div>

        <div class="col-12 col-md-4 d-flex">
            <div class="card card-glass metric-card h-100 w-100">
                <div class="card-body">
                    <div class="text-muted small">Aproveitamento</div>
                    <div class="display-6 fw-bold"
                         th:text="${#numbers.formatDecimal((acertos*100.0)/total, 1, 1)} + ' %'">0 %</div>
                    <div class="text-muted small" th:text="'Total: ' + ${total} + ' questões'">Total</div>
                </div>
            </div>
        </div>
    </div>


    <!-- Gabarito -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card card-glass">
                <div class="card-body p-4 p-lg-5">
                    <h2 class="h4 mb-4">Gabarito</h2>

                    <div th:each="q,idx : ${questoes}" class="mb-3"
                         th:with="
                                   es=${#strings.trim(q.escolhida)},
                                   co=${#strings.trim(q.correta)},
                                   ok=${es != null and #strings.equalsIgnoreCase(es, co)},
                                   txtEscolhida=${es=='A' ? q.a : (es=='B' ? q.b : (es=='C' ? q.c : (es=='D' ? q.d : '-')))},
                                   txtCorreta=${co=='A' ? q.a : (co=='B' ? q.b : (co=='C' ? q.c : (co=='D' ? q.d : '-')))}
                                 ">
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <div class="fw-semibold" th:text="'#' + (${idx.index}+1) + ' — ' + ${q.areaNome}">#1 — Área</div>
                                <span>
                                  <i class="fa-regular fa-circle-check fa-2x text-success" th:if="${ok}"></i>
                                  <i class="fa-regular fa-circle-xmark fa-2x text-danger" th:if="${!ok}"></i>
                                </span>
                            </div>

                        <div class="mb-2" th:text="${q.enunciado}">Enunciado</div>

                        <!-- ACERTOU: 1 linha só -->
                        <div class="answer-line" th:if="${ok}">
                            <div class="small text-muted">Marcada / Correta</div>
                            <div>
                                <b th:text="${co}">A</b> <span> — </span>
                                <span th:text="${txtCorreta}">Texto correto</span>
                            </div>
                        </div>

                        <!-- ERROU: mostra as duas -->
                        <div th:if="${!ok}">
                            <div class="answer-line">
                                <div class="small text-muted">Marcada</div>
                                <div>
                                    <b th:text="${es}">A</b> <span> — </span>
                                    <span th:text="${txtEscolhida}">Texto marcado</span>
                                </div>
                            </div>
                            <div class="answer-line">
                                <div class="small text-muted">Correta</div>
                                <div>
                                    <b th:text="${co}">A</b> <span> — </span>
                                    <span th:text="${txtCorreta}">Texto correto</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr class="mt-4"/>
                    <div class="text-muted small">
                        Observação: respostas não marcadas não retiram pontos.
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Rodapé de ações (fixo) -->
<div class="action-footer">
    <div class="container d-flex justify-content-between">
        <a class="btn btn-outline-light" th:href="@{/}">← Nova tentativa</a>
        <!-- Link do PDF: ajuste a rota quando implementar -->
        <a class="btn btn-success" th:href="@{/resultado/pdf}">Baixar PDF</a>
    </div>
</div>

<!-- Bootstrap + script do tema -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/scripts.js}"></script>
</body>
</html>
