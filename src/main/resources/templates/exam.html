<!doctype html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Simulado • Prova</title>

  <link rel="stylesheet" th:href="@{/css/styles.css}"/>

  <!-- toques visuais para combinar com o configurar -->
  <style>
    :root{
      --bs-primary:#0b2a5b; /* azul escuro */
      --bs-success:#28a745; /* verde de acerto */
    }
    body{
      min-height:100vh;
      background:
              radial-gradient(1200px 600px at 10% -20%, rgba(11,42,91,.08), transparent 60%),
              radial-gradient(1200px 600px at 110% 120%, rgba(11,42,91,.08), transparent 60%),
              #f7f9fc;
    }
    .card-glass{
      background: rgba(255,255,255,.94);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      border: 1px solid rgba(11,42,91,.06);
      box-shadow: 0 10px 30px rgba(11,42,91,.08);
    }
    .brand-logo{height:32px}
    .alt-item input[type="radio"]{display:none}
    .alt-item label{
      width:100%;
      cursor:pointer;
      padding:.9rem 1rem;
      border:1px solid #e5e7eb;
      border-radius:.5rem;
      background:#fff;
      transition:.15s ease-in-out;
    }
    .alt-item + .alt-item{margin-top:.75rem}
    .alt-item input[type="radio"]:checked + label{
      border-color: var(--bs-primary);
      box-shadow: 0 0 0 .2rem rgba(11,42,91,.15);
    }
    .kbd{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,"Liberation Mono","Courier New", monospace; background:#eef1f4; border-radius:.35rem; padding:.1rem .45rem}
  </style>
</head>
<body>

<!-- Navbar com logo + timer -->
<nav class="navbar navbar-dark bg-dark">
  <div class="container px-4 px-lg-5">
    <a class="navbar-brand d-flex align-items-center" th:href="@{/}">
      <img class="brand-logo me-2" th:src="@{/assets/img/logo.png}" alt="Simulado Online">
      <span>Simulado Online</span>
    </a>

    <div class="d-flex align-items-center gap-3">
      <span class="text-white-50 small" th:text="${nome}">Participante</span>
      <span id="timer" class="badge bg-success" th:if="${restanteMs != null}">--:--:--</span>
      <span class="badge bg-secondary" th:if="${restanteMs == null}">Sem limite</span>
    </div>
  </div>
</nav>

<!-- Barra de progresso -->
<div class="container px-4 px-lg-5 mt-3">
  <div class="progress" style="height:8px;">
    <div class="progress-bar"
         role="progressbar"
         th:style="'width:' + (((${pos}+1) * 100.0) / ${total}) + '%'"
         th:aria-valuenow="${pos+1}"
         th:aria-valuemin="0"
         th:aria-valuemax="${total}">
    </div>
  </div>
  <div class="d-flex justify-content-between mt-2">
    <small class="text-muted" th:text="'Questão ' + (${pos}+1) + ' de ' + ${total}">Questão</small>
    <small class="text-muted" th:if="${q.areaNome != null}" th:text="${q.areaNome}">Área</small>
  </div>
</div>

<main class="container py-4">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-10">
      <div class="card card-glass">
        <div class="card-body p-4 p-lg-5">

          <!-- Enunciado -->
          <h5 class="mb-3">Leia e marque a alternativa correta:</h5>
          <p class="mb-4 lead" th:text="${q.enunciado}">Enunciado</p>

          <!-- Form -->
          <form method="post" action="/responder">
            <input type="hidden" name="pos" th:value="${pos}"/>

            <!-- Alternativas (A–D) -->
            <div class="alt-item">
              <input id="altA" type="radio" name="alternativa" value="A" th:checked="${q.escolhida=='A'}"/>
              <label for="altA"><b>A.</b> <span th:text="${q.a}">Alternativa A</span></label>
            </div>

            <div class="alt-item">
              <input id="altB" type="radio" name="alternativa" value="B" th:checked="${q.escolhida=='B'}"/>
              <label for="altB"><b>B.</b> <span th:text="${q.b}">Alternativa B</span></label>
            </div>

            <div class="alt-item">
              <input id="altC" type="radio" name="alternativa" value="C" th:checked="${q.escolhida=='C'}"/>
              <label for="altC"><b>C.</b> <span th:text="${q.c}">Alternativa C</span></label>
            </div>

            <div class="alt-item mb-4">
              <input id="altD" type="radio" name="alternativa" value="D" th:checked="${q.escolhida=='D'}"/>
              <label for="altD"><b>D.</b> <span th:text="${q.d}">Alternativa D</span></label>
            </div>

            <!-- Navegação -->
            <div class="d-flex justify-content-between">
              <button name="acao" value="ant" class="btn btn-outline-dark"
                      th:disabled="${pos==0}">← Anterior</button>

              <div>
                <button name="acao" value="prox" class="btn btn-primary px-4"
                        th:if="${pos < (total - 1)}">Próxima →</button>

                <button name="acao" value="fim" class="btn btn-danger px-4"
                        th:if="${pos == (total - 1)}">Encerrar simulado</button>
              </div>
            </div>

            <p class="text-muted mt-3 small">
              Dica: você pode navegar com <span class="kbd">←</span> e <span class="kbd">→</span> (setas) após marcar uma alternativa.
            </p>
          </form>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Timer -->
<script th:inline="javascript">
  /*<![CDATA[*/
  const restante = /*[[${restanteMs}]]*/ null;
  if (restante !== null) {
    let ms = Number(restante);
    const el = document.getElementById('timer');
    const fmt = (t)=> {
      const s = Math.max(0, Math.floor(t/1000));
      const h = Math.floor(s/3600), m = Math.floor((s%3600)/60), sc = s%60;
      const dd = (n)=>n.toString().padStart(2,'0');
      return `${dd(h)}:${dd(m)}:${dd(sc)}`;
    };
    const id = setInterval(()=>{
      ms -= 1000;
      if (el) el.textContent = fmt(ms);
      if (ms <= 0) {
        clearInterval(id);
        fetch("/finalizar", {method:"POST"}).then(()=>location.href="/resultado");
      }
    },1000);
    if (el) el.textContent = fmt(ms);
  }
  /*]]>*/
</script>

<!-- Navegação por teclado (opcional, leve) -->
<script>
  document.addEventListener('keydown', (e) => {
    const form = document.querySelector('form[action="/responder"]');
    if (!form) return;
    if (e.key === 'ArrowLeft') {
      const btn = form.querySelector('button[name="acao"][value="ant"]:not([disabled])');
      if (btn) { e.preventDefault(); btn.click(); }
    } else if (e.key === 'ArrowRight') {
      const next = form.querySelector('button[name="acao"][value="prox"]');
      const end  = form.querySelector('button[name="acao"][value="fim"]');
      const btn = next || end;
      if (btn) { e.preventDefault(); btn.click(); }
    }
  });
</script>

<!-- Bootstrap + script do tema -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/scripts.js}"></script>
</body>
</html>
