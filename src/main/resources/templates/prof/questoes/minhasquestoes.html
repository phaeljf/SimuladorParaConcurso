<!doctype html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <title>Minhas Questões • Área do Professor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" th:href="@{/css/styles.css}"/>
</head>
<body>
<nav class="navbar navbar-dark bg-dark">
  <div class="container d-flex justify-content-between">
    <a class="navbar-brand" th:href="@{/prof}"
       th:text="${prof != null ? 'Professor • ' + prof.nome() : 'Professor'}">Professor</a>
    <div class="d-flex gap-2">
      <a class="btn btn-success btn-sm" th:href="@{/prof/questoes/nova}">+ Nova questão</a>
      <form method="post" th:action="@{/prof/logout}">
        <button class="btn btn-outline-light btn-sm" type="submit">Sair</button>
      </form>
    </div>
  </div>
</nav>

<main class="container py-4">
  <h1 class="h5 mb-3">Minhas questões</h1>

  <!-- Filtros -->
  <form id="filtroQ"
        class="row g-2 align-items-end mb-3"
        th:action="@{/prof/questoes/minhas}"
        method="get">

    <!-- 7/12: texto -->
    <div class="col-12 col-md-5">
      <label class="form-label">Buscar no enunciado</label>
      <input class="form-control" name="q" th:value="${f_q}" placeholder="Buscar no enunciado">
    </div>

    <!-- 3/12: área -->
    <div class="col-6 col-md-3 ">
      <label class="form-label">Área</label>
      <select class="form-select" name="areaId">
        <option value="">Todas</option>
        <option th:each="a : ${areas}"
                th:value="${a.id}"
                th:text="${a.nome}"
                th:selected="${f_areaId} == ${a.id}">
          Área
        </option>
      </select>
    </div>

    <!-- 2/12: botões -->
    <div class="col-6 col-md-3">
      <label class="form-label d-none d-md-block">&nbsp;</label>
      <div class="d-grid d-md-flex gap-4">
        <button class="btn btn-primary" type="submit">Filtrar</button>
        <a class="btn btn-primary" th:href="@{/prof/questoes/minhas}">Limpar</a>
      </div>
    </div>
  </form>


  <!-- Lista -->
  <div class="list-group" th:if="${lista != null and !#lists.isEmpty(lista)}">
    <div class="list-group-item d-flex justify-content-between align-items-start"
         th:each="q : ${lista}">
      <div class="me-3 flex-grow-1">
        <div class="small text-muted mb-1">
          <b th:text="'#' + ${q.id}">#</b>
          • <span th:text="${q.areaConhecimento != null ? q.areaConhecimento.nome : 'Sem área'}">Área</span>
          • <span th:text="'Correta: ' + ${q.correta}">Correta</span>
          • <span th:text="${q.publica} ? 'Pública' : 'Privada'">Visibilidade</span>
        </div>

        <!-- se quiser truncar em uma linha para não empurrar os botões -->
        <div th:text="${q.enunciado}"
             style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width: 70ch;">
          Enunciado...
        </div>
      </div>

      <div class="d-flex gap-2 flex-shrink-0">
        <a class="btn btn-primary btn-sm btn-eq"
           th:href="@{/prof/questoes/{id}/editar(id=${q.id})}">Editar</a>

        <form class="d-inline"
              th:action="@{|/prof/questoes/${q.id}/excluir|}"
              method="post"
              onsubmit="return confirm('Excluir esta questão?')">
          <button class="btn btn-danger btn-sm btn-eq" type="submit">Excluir</button>
        </form>
      </div>
    </div>
  </div>


  <div class="alert alert-info" th:if="${lista == null or #lists.isEmpty(lista)}">
    Você ainda não cadastrou questões.
  </div>

  <!-- Paginação -->
  <div class="d-flex justify-content-center mt-3"
       th:if="${pagina != null and pagina.totalPages > 1}">
    <nav aria-label="Paginação">
      <ul class="pagination mb-0">
        <!-- anterior -->
        <li class="page-item" th:classappend="${pagina.first}? 'disabled'">
          <a class="page-link"
             th:href="@{/prof/questoes/minhas(page=${pagina.number - 1}, q=${f_q}, areaId=${f_areaId})}">«</a>
        </li>

        <!-- números -->
        <li class="page-item"
            th:each="i : ${#numbers.sequence(0, pagina.totalPages - 1)}"
            th:classappend="${i == pagina.number}? 'active'">
          <a class="page-link"
             th:text="${i + 1}"
             th:href="@{/prof/questoes/minhas(page=${i}, q=${f_q}, areaId=${f_areaId})}">1</a>
        </li>

        <!-- próxima -->
        <li class="page-item" th:classappend="${pagina.last}? 'disabled'">
          <a class="page-link"
             th:href="@{/prof/questoes/minhas(page=${pagina.number + 1}, q=${f_q}, areaId=${f_areaId})}">»</a>
        </li>
      </ul>
    </nav>
  </div>
</main>

<script th:src="@{/js/scripts.js}"></script>
</body>
</html>
