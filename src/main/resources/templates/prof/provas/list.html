<!doctype html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <title>Minhas Provas • Área do Professor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" th:href="@{/css/styles.css}"/>
</head>
<body>
<nav class="navbar navbar-dark bg-dark">
  <div class="container d-flex justify-content-between">
    <a class="navbar-brand" th:href="@{/prof}"
       th:text="${prof != null ? 'Professor • ' + prof.nome() : 'Professor'}">Professor</a>
    <div class="d-flex gap-2">
      <a class="btn btn-success btn-sm" th:href="@{/prof/provas/nova}">+ Nova Prova</a>
      <form method="post" th:action="@{/prof/logout}">
        <button class="btn btn-outline-light btn-sm" type="submit">Sair</button>
      </form>
    </div>
  </div>
</nav>

<main class="container py-4">
  <h1 class="h5 mb-3">Minhas Provas</h1>

  <div class="alert alert-success" th:if="${ok}" th:text="${ok}"></div>
  <div class="alert alert-danger" th:if="${erro}" th:text="${erro}"></div>

  <!-- Filtro por título -->
  <form id="filtroP" method="get" class="row g-2 align-items-end mb-3">
    <div class="col-12 col-md-8">
      <label class="form-label">Buscar pelo título</label>
      <input class="form-control" name="q" th:value="${f_q}" placeholder="Digite parte do título...">
    </div>
    <div class="col-12 col-md-4 d-flex gap-2">
      <button class="btn btn-primary w-100" type="submit">Filtrar</button>
      <a class="btn btn-primary w-100" th:href="@{/prof/provas}">Limpar</a>
    </div>
  </form>

  <!-- Lista -->
  <div class="list-group" th:if="${lista != null and !#lists.isEmpty(lista)}">
    <div class="list-group-item d-flex justify-content-between align-items-center" th:each="p : ${lista}">
      <div class="me-3">
        <b th:text="${p.titulo}">Título</b>
        <div class="small text-muted mt-1">
          <span th:text="${p.publica} ? 'Pública' : 'Privada'">Pública</span>
          • <span th:text="${p.mostrarGabarito} ? 'Mostra gabarito' : 'Oculta gabarito'">Mostra gabarito</span>
          <span th:if="${p.tempoMinutos != null}"> • <span th:text="${p.tempoMinutos} + ' min'">0 min</span></span>
        </div>
        <div class="text-muted" th:if="${p.descricao}" th:text="${p.descricao}" style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width: 60ch;">
          Descrição...
        </div>
      </div>

      <div class="d-flex gap-2">
        <a class="btn btn-primary btn-sm btn-eq" th:href="@{/prof/provas/{id}/editar(id=${p.id})}">Editar</a>

        <form class="d-inline" th:action="@{|/prof/provas/${p.id}/excluir|}" method="post"onsubmit="return confirm('Excluir esta prova?')">
          <button class="btn btn-danger btn-sm btn-eq" type="submit">Excluir</button>
        </form>
      </div>
    </div>
  </div>

  <div class="alert alert-info" th:if="${lista == null or #lists.isEmpty(lista)}">
    Prova não encontrada.
  </div>

  <!-- Paginação -->
  <div class="d-flex justify-content-center mt-3"
       th:if="${pagina != null and pagina.totalPages > 1}">
    <nav aria-label="Paginação">
      <ul class="pagination mb-0">
        <!-- anterior -->
        <li class="page-item" th:classappend="${pagina.first} ? 'disabled'">
          <a class="page-link"
             th:href="@{/prof/provas(page=${pagina.number - 1}, q=${f_q})}">«</a>
        </li>

        <!-- números -->
        <li class="page-item"
            th:each="i : ${#numbers.sequence(0, pagina.totalPages - 1)}"
            th:classappend="${i == pagina.number} ? 'active'">
          <a class="page-link"
             th:text="${i + 1}"
             th:href="@{/prof/provas(page=${i}, q=${f_q})}">1</a>
        </li>

        <!-- próxima -->
        <li class="page-item" th:classappend="${pagina.last} ? 'disabled'">
          <a class="page-link"
             th:href="@{/prof/provas(page=${pagina.number + 1}, q=${f_q})}">»</a>
        </li>
      </ul>
    </nav>
  </div>
</main>

<script th:src="@{/js/scripts.js}"></script>
</body>
</html>
