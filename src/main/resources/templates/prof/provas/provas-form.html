<!doctype html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <title th:text="${pv != null ? 'Editar Prova' : 'Nova Prova'}">Nova Prova</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" th:href="@{/css/styles.css}"/>
</head>
<body>
<nav class="navbar navbar-dark bg-dark">
  <div class="container d-flex justify-content-between">
    <a class="navbar-brand" th:href="@{/prof}"
       th:text="${prof != null ? 'Professor • ' + prof.nome() : 'Professor'}">Professor</a>
    <div class="d-flex gap-2">
      <a class="btn btn-success btn-sm" th:href="@{/prof/provas}">Minhas Provas</a>
      <form method="post" th:action="@{/prof/logout}">
        <button class="btn btn-outline-light btn-sm" type="submit">Sair</button>
      </form>
    </div>
  </div>
</nav>

<main class="container py-4">
  <h1 class="h5 mb-3" th:text="${pv != null ? 'Editar Prova' : 'Criar Prova'}">Criar Prova</h1>

  <!-- ====================== EDITAR ====================== -->
  <form th:if="${pv != null}" id="provaFormE"
        class="card p-3" method="post"
        th:action="@{/prof/provas/{id}/editar(id=${pv.id})}"
        th:attr="data-prova-id=${pv.id}">

    <div class="mb-3">
      <label class="form-label">Título</label>
      <input class="form-control" name="titulo" required maxlength="120" th:value="${pv.titulo}">
    </div>

    <div class="mb-3">
      <label class="form-label">Descrição</label>
      <textarea class="form-control" name="descricao" rows="3" th:text="${pv.descricao}"></textarea>
    </div>

    <div class="row g-2">
      <div class="col-12 col-md-4">
        <label class="form-label">Tempo (minutos)</label>
        <input class="form-control" name="tempoMinutos" type="number" min="1" th:value="${pv.tempoMinutos}">
      </div>
      <div class="col-12 col-md-4 d-flex align-items-end">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="publicaE" name="publica" value="true" th:checked="${pv.publica}">
          <label class="form-check-label" for="publicaE">Prova pública</label>
        </div>
      </div>
      <div class="col-12 col-md-4 d-flex align-items-end">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="mostrarGabaritoE" name="mostrarGabarito" value="true" th:checked="${pv.mostrarGabarito}">
          <label class="form-check-label" for="mostrarGabaritoE">Mostrar gabarito no fim</label>
        </div>
      </div>
    </div>

    <hr class="my-3"/>

    <h2 class="h6 mb-2">Questões desta prova</h2>
    <div id="listaSelE" class="list-group mb-2"><!-- render via JS --></div>

    <!-- inputs hidden (um por ID) -->
    <div id="itensHiddenE">
      <input type="hidden" name="itens" th:each="id : ${pvItens}" th:value="${id}">
    </div>

    <div class="d-flex gap-2">
      <button type="button" class="btn btn-primary" id="btnAbrirBuscaE">Adicionar questão</button>
      <button type="button" class="btn btn-outline-secondary" id="btnLimparSelE">Limpar seleção</button>
    </div>

    <!-- Painel de busca (inline) -->
    <div id="painelBuscaE" class="card mt-3 d-none">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h3 class="h6 m-0">Adicionar questões</h3>
          <div class="d-flex gap-2">
            <button type="button" class="btn btn-sm btn-outline-primary" id="btnAddSelE">Adicionar selecionadas</button>
            <button type="button" class="btn btn-outline-secondary btn-sm" id="btnFecharBuscaE">Fechar</button>
          </div>
        </div>
        <div id="fBuscaQE" class="row g-1 align-items-start mb-3">
          <div class="col-12 col-md-3">
            <label class="form-label">Texto</label>
            <input class="form-control" id="buscarTextoE" placeholder="digite para filtrar...">
          </div>

          <div class="col-12 col-md-2">
            <label class="form-label">Área</label>
            <select class="form-select" id="buscarAreaE">
              <option value="">Todas</option>
              <option th:each="a : ${areas}" th:value="${a.id}" th:text="${a.nome}">Área</option>
            </select>
          </div>
          <div class="col-12 col-md-2">
            <label class="form-label">Dificuldade</label>
            <select class="form-select" id="buscarDificuldadeE">
              <option value="">Todas</option>
              <option value="Facil">Fácil</option>
              <option value="Moderada">Moderada</option>
              <option value="Dificil">Difícil</option>
            </select>
          </div>
          <div class="col-12 col-md-2">
            <label class="form-label">Escolaridade</label>
            <select class="form-select" id="buscarEscolaridadeE">
              <option value="">Todas</option>
              <option value="Fundamental">Fundamental</option>
              <option value="Medio">Médio</option>
              <option value="Superior">Superior</option>
            </select>
          </div>
          <div class="col-12 col-md-3">
            <label class="form-label align-top">Origem</label>
            <div class="d-flex align-items-center gap-3 mt-2">
              <label class="form-check-label">
                <input class="form-check-input me-1" type="checkbox" id="buscarMinhasE" checked> Minhas
              </label>
              <label class="form-check-label">
                <input class="form-check-input me-1" type="checkbox" id="buscarPublicasE" checked> Públicas
              </label>
            </div>
          </div>
        </div>

        <div id="resQE" class="list-group"></div>
        <div class="d-flex justify-content-center mt-2" id="pagQE"></div>
      </div>
    </div>

    <div class="d-flex justify-content-between mt-4">
      <a class="btn btn-outline-secondary" th:href="@{/prof/provas}">← Voltar</a>
      <button class="btn btn-primary" type="submit">Salvar alterações</button>
    </div>
  </form>

  <!-- ====================== CRIAR ====================== -->
  <form th:unless="${pv != null}" id="provaFormC"
        class="card p-3" method="post"
        th:action="@{/prof/provas/nova}">

    <div class="mb-3">
      <label class="form-label">Título</label>
      <input class="form-control" name="titulo" required maxlength="120">
    </div>

    <div class="mb-3">
      <label class="form-label">Descrição</label>
      <textarea class="form-control" name="descricao" rows="3"></textarea>
    </div>

    <div class="row g-2">
      <div class="col-12 col-md-4">
        <label class="form-label">Tempo (minutos)</label>
        <input class="form-control" name="tempoMinutos" type="number" min="1" value="120">
      </div>
      <div class="col-12 col-md-4 d-flex align-items-end">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="publicaC" name="publica" value="true">
          <label class="form-check-label" for="publicaC">Prova pública</label>
        </div>
      </div>
      <div class="col-12 col-md-4 d-flex align-items-end">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="mostrarGabaritoC" name="mostrarGabarito" value="true" checked>
          <label class="form-check-label" for="mostrarGabaritoC">Mostrar gabarito no fim</label>
        </div>
      </div>
    </div>

    <hr class="my-3"/>

    <h2 class="h6 mb-2">Questões desta prova</h2>
    <div id="listaSelC" class="list-group mb-2"><!-- render via JS --></div>

    <!-- contêiner para inputs hidden (um por id) -->
    <div id="itensHiddenC"></div>

    <div class="d-flex gap-2">
      <button type="button" class="btn btn-primary" id="btnAbrirBuscaC">Adicionar questão</button>
      <button type="button" class="btn btn-outline-secondary" id="btnLimparSelC">Limpar seleção</button>
    </div>

    <!-- Painel de busca (inline, sem <form> interno) -->
    <div id="painelBuscaC" class="card mt-3 d-none">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h3 class="h6 m-0">Adicionar questões</h3>
          <div class="d-flex gap-2">
            <button type="button" class="btn btn-sm btn-outline-primary" id="btnAddSelC">Adicionar selecionadas</button>
            <button type="button" class="btn btn-outline-secondary btn-sm" id="btnFecharBuscaC">Fechar</button>
          </div>
        </div>

        <div id="fBuscaQC" class="row g-2 align-items-end mb-3">
          <div class="col-12 col-md-5">
            <label class="form-label">Texto</label>
            <input class="form-control" id="buscarTextoC" placeholder="digite para filtrar...">
          </div>
          <div class="col-12 col-md-3">
            <label class="form-label">Área</label>
            <select class="form-select" id="buscarAreaC">
              <option value="">Todas</option>
              <option th:each="a : ${areas}" th:value="${a.id}" th:text="${a.nome}">Área</option>
            </select>
          </div>
          <!-- ... dentro de #fBuscaQC -->
          <div class="col-12 col-md-3">
            <label class="form-label">Dificuldade</label>
            <select class="form-select" id="buscarDificuldadeC">
              <option value="">Todas</option>
              <option value="FACIL">Fácil</option>
              <option value="MODERADA">Moderada</option>
              <option value="DIFICIL">Difícil</option>
            </select>
          </div>
          <div class="col-12 col-md-3">
            <label class="form-label">Escolaridade</label>
            <select class="form-select" id="buscarEscolaridadeC">
              <option value="">Todas</option>
              <option value="FUNDAMENTAL">Fundamental</option>
              <option value="MEDIO">Médio</option>
              <option value="SUPERIOR">Superior</option>
            </select>
          </div>
          <div class="col-12 col-md-4">
            <label class="form-label">Origem</label>
            <div class="d-flex align-items-center gap-3 mt-1">
              <label class="form-check-label">
                <input class="form-check-input me-1" type="checkbox" id="buscarMinhasC" checked> Minhas
              </label>
              <label class="form-check-label">
                <input class="form-check-input me-1" type="checkbox" id="buscarPublicasC" checked> Públicas
              </label>
            </div>
          </div>
        </div>

        <div id="resQC" class="list-group"></div>
        <div class="d-flex justify-content-center mt-2" id="pagQC"></div>
      </div>
    </div>

    <div class="d-flex justify-content-between mt-4">
      <a class="btn btn-outline-secondary" th:href="@{/prof/provas}">← Voltar</a>
      <button class="btn btn-primary" type="submit">Salvar</button>
    </div>
  </form>
</main>

<!-- JS global (o bloco de Prova deve estar no final de scripts.js) -->
<script th:src="@{/js/scripts.js}"></script>
</body>
</html>
